<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dependency Web</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="./css/bootstrap-responsive.css" rel="stylesheet">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.3.0/knockout-min.js"></script>
    <script src="./knockout.mapping-latest.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="./dwcore.js" type="text/javascript"></script>
    <script src="./depweb_graph.js" type="text/javascript"></script>
    <script src="./dwui.js" type="text/javascript"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./main.js"></script>
<style>
html, body {
  margin: 0px; /*5%;
  width: 100%;
  height: 100%;*/
  padding-top: 30px;
}
div#graph {
  width: 90%;
  height: 90%;
}
.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}
.textnode {
  stroke: #000;
  stroke-width: 0em;
}
#dw_graph {
  width: 100%;
  height: 700px;
}
#f_nodes {
  font-size: .75em;
}
#f_nodes .f_need span.f_need_remove {
  font-size: .75em;
}
#node_table tr td:first-child {
  text-align: right;
  padding-left: 3em;
  padding-right: 1em;
}
#node_table tr td span.beleted {
  font-size: .8em;
}
</style>
<body>
<textarea style="display:none;" id="dw_text">[
  {"name": "Home"}
  ,{"name": "Internet", "needs":["Power","Home"]}
  ,{"name": "Power", "needs": ["Home"]}
  ,{"name": "Dragon", "needs": ["Power"]}
  ,{"name": "DNS", "needs":["Internet", "Dragon"]}
  ,{"name": "Netflix", "needs":["DNS","Internet"]}
]</textarea>
<div class="navbar navbar-inverse navbar-fixed-top" style="display: none;">
  <div class="navbar-inner">
    <div class="container">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="brand" href="#">Project name</a>
      <div class="nav-collapse collapse">
        <ul class="nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row-fluid" id="io">
    <div class="span4">
      <div class="navbar">
        <div class="navbar-inner">
          <ul class="nav">
            <li><a href="#">Create</a></li>
            <li><a href="#">Import/Advanced</a></li>
            <li><a href="#">Export</a></li>
          </ul>
        </div>
      </div>
      <div style="border:1px solid black">
        <form id="f_nodes">
          <script type="text/html" id="dwui_nodes">
            <tr>
              <td>n: <span data-bind="text: node.name"></span></td>
              <td>
                <span data-bind="foreach: {data: node.needs.list, as: 'need'}">
                  <span data-bind="text: need"></span><span class="beleted" data-bind="click: $root.self.removeNeed.bind($root.self, node)">(x)</span>
                </span>
                <span data-bind="click: $dwui.addNodePrompt.bind($root.self)" class="addneeds">+<span>
              </td>
            </tr>
          </script>
          <table id="node_table" data-bind="template: { name: 'dwui_nodes', foreach: nodes, as: 'node' }">
          </table>
        </form>
      </div>
    </div>
    <div class="span8">
      <div id="dw_graph"></div>
    </div>
  </div>
</div> <!-- /container -->
<div id="res" style="display: none;">
  <div class="addNodePrompt">
    <form class="form-inline">
      <input type="text" class="input-small needname" placeholder="Node Name">
      <button type="" class="btn">Add</button>
    </form>
  </div>
</div>

<!--<div>
  <div class="row">
    <div class='span12'>
      <div class="row">
        <div class="span1">Create</div>
        <div class="span1">Import</div>
        <div class="span1">Clear</div>
      </div>
    </div>
    <div class="span4" style="display: none">
      <div id="dw_form">
        <form id="f_nodes">
          <script type="text/html" id="dwui_nodes">
            <div class="row">
              <div class="span2">N: <span data-bind="text: node.name"></span></div>
              
              <div class="span2">
                <div class="row" data-bind="if: typeof node != 'undefiend'">
                  <span data-bind="foreach: {data: node.needs.list, as: 'need'}">
                      <span class="f_need">
                        <span data-bind="text: need"></span>
                        <span class="f_need_remove" data-bind="click: $root.self.removeNeed.bind($root.self, node)">Remove</span>
                      </span>
                  </span>
                </div>
                <div class="row">
                  <input type="text" data-bind="event: { keypress: $root.self.addNeed.bind($root.self, node) }" />
                </div>
              </span>
            </div>
          </script>
          <div data-bind="template: { name: 'dwui_nodes', foreach: nodes, as: 'node' }"></div>
          <div class="row">
            <div class="span1"></div>
            <div class="span2">N: <input type="text" data-bind="event: { keypress: $root.self.addNode.bind($root.self) }" /> <input type="button" value="add" /></div>
            <div class="span2">
              <div data-binder="foreach: {data: node.needs, as: 'need'}">
                <div class="row">
                  <div class="f_need">
                    <span data-binder="text: need"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="span7">
      <div id="dw_graph"></div>
    </div>
  </div>
</div>-->
<script>
/*
  somewhat modified from the d3js example http://bl.ocks.org/mbostock/4062045
*/
var dwf_recreate = function() {
  //console.log($('#dw_text').val());
  try {
    var width = $('#dw_graph')[0].clientWidth*.9;
    var height = $('#dw_graph')[0].clientHeight*.9;
    try { myg.graph.stop(); } catch(e){}
    //delete myg;
    myg = null;
    $('#dw_graph *').remove();
    myg = new $depweb_graph('#dw_graph', width, height, $dwcore.fromArray(JSON.parse($('#dw_text').val())));
  } catch(e) {
    console.log(e.stack);
  }
}
var myg;
/*$(document).ready(function() {  
  $.get('./data.json', function(d) {
    var width = $('#dw_graph')[0].clientWidth*.9;
    var height = $('#dw_graph')[0].clientHeight*.9;
    var pd = $depweb.fromArray(d);
    //debugger;
    //myg = new $depweb_graph('#dw_graph', width, height, pd);
  })
})*/
</script>
<script type="text/javascript">
  var dwui;
  /*setTimeout(function() {
    console.log(new Date());
    (function() { var n = new $depweb.node("A night in", 1, ["Home", "Netflix", "Couch"]); myg.addData(n); })();
  }, 3000 );

  setTimeout(function() {
    console.log(new Date());
    (function() { var n = myg.data.nodesByName["A night in"]; n.needs.push("Dragon"); myg.updateData(n); })();
  }, 5000);

  setTimeout(function() {
    console.log(new Date());
    console.log("delete link ");
    (function() { var n = myg.data.nodesByName["A night in"]; n.needs = n.needs.filter(function(d){ return (d != "Dragon"); }); console.log("new n needs", n.needs); myg.updateData(n); })();
  }, 7000);*/
</script>
</body>
</html>
