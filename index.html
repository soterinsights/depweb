<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Depweb: Dependency Web graphs for the management in all of us.</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="./css/bootstrap-responsive.css" rel="stylesheet">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.3.0/knockout-min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="./knockout.mapping-latest.js"></script>
    <script src="./dwcore.js" type="text/javascript"></script>
    <script src="./depweb_graph.js" type="text/javascript"></script>
    <script src="./dwui.js" type="text/javascript"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./main.js"></script>
<style>
html, body {
  margin: 0px; /*5%;
  width: 100%;
  height: 100%;*/
  padding-top: 10px;
}
div#graph {
  width: 90%;
  height: 90%;
}
.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}
.textnode {
  stroke: #000;
  stroke-width: 0em;
}
#dw_graph {
  width: 100%;
  height: 700px;
}
#f_nodes {
  font-size: .75em;
}
#f_nodes .f_need span.f_need_remove {
  font-size: .75em;
}
#node_table tr td:first-child {
  text-align: right;
  padding-left: 3em;
  padding-right: 1em;
}
#node_table tr td span.beleted {
  font-size: .8em;
}
.json_data {
  width: 100%;
  min-height: 400px;
}
.itsdeadjimforreal {
  color: red;
}
</style>
<body>
<!--
  {"name": "Home"}
  ,{"name": "Internet", "needs":["Power","Home"]}
  ,{"name": "Power", "needs": ["Home"]}
  ,{"name": "Dragon", "needs": ["Power"]}
  ,{"name": "DNS", "needs":["Internet", "Dragon"]}
  ,{"name": "Netflix", "needs":["DNS","Internet"]}-->
<textarea style="display:none;" id="dw_text">[
  {"name": "Power", "fneeds": {"power": ["Power Grid", "Generator"]}}
  ,{"name": "Building", "needs": ["Power"]}
  ,{"name": "Switch", "needs": ["Building", "Power"]}
  ,{"name": "Server", "needs": ["Switch","Building", "Power"]}
  ,{"name": "Exchange (Service)", "needs": ["Server"]}
  ,{"name": "Server HTTP/IIS", "needs": ["Server"]}
  ,{"name": "Outlook Web/ActiveSync", "needs": ["Exchange (Service)", "Server HTTP/IIS"]}
  ,{"name": "Phone Email", "needs": ["Outlook Web/ActiveSync", "Internet"]}
  ,{"name": "Router", "needs": ["Building", "Power"]}
  ,{"name": "Internet", "needs": ["ISP", "Router"]}
  ,{"name": "Hyper-V Cluster", "fneeds": {"hvcs": ["hyper1", "hyper2"]}}
  ,{"name": "Terminal Server", "needs": ["Hyper-V Cluster"]}
  ,{"name": "Thinstations", "needs": ["Terminal Server"]}
  ,{"name": "hyper1", "needs": ["Power", "Switch", "Building"]}
  ,{"name": "hyper2", "needs": ["Power", "Switch", "Building"]}
]</textarea>
<div class="navbar navbar-inverse navbar-fixed-top" style="display: none;">
  <div class="navbar-inner">
    <div class="container">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="brand" href="#">Project name</a>
      <div class="nav-collapse collapse">
        <ul class="nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row-fluid" id="io">
    <div class="span4">
      <div class="navbar">
        <div class="navbar-inner">
          <ul class="nav">
            <li><a href="#" data-bind="click: $root.self.clear.bind($root.self)">New/Clear</a></li>
            <li><a href="#" data-bind="click: $root.self.switch.bind($root.self, 'uiinputs')" >Easy</a></li>
            <li><a href="#" data-bind="click: $root.self.switch.bind($root.self, 'import_adv')" >Import/Advanced</a></li>
            <li><a href="#" data-bind="click: $root.self.switch.bind($root.self, 'export')" >Export</a></li>
            <li><a href="#" data-bind="click: $root.self.switch.bind($root.self, 'help')" >Help</a></li>
            <li><a href="#" data-bind="click: $root.self.switch.bind($root.self, 'about')" >About</a></li>
          </ul>
        </div>
      </div>
      <div class="input_methods" id="uiinputs">
        <div id="f_nodes">
          <script type="text/html" id="dwui_nodes">
            <tr>
              <td>
                n: <span data-bind="text: node.name, css: { itsdeadjimforreal: $root.self.checkTreeDead(node) }"></span>
                <span class="killitwithfire" data-bind="click: $root.self.markDead.bind($root.self), css: { itsdeadjimforreal: $root.self.checkDead(node) }">(d)</span>
                <span class="beleted" data-bind="click: $root.self.removeNode.bind($root.self, node)">(X)</span>
              </td>
              <td>
                <div>
                  <span data-bind="foreach: {data: node.needs, as: 'need'}">
                    <span data-bind="text: need.name"></span><span class="beleted" data-bind="click: $root.self.removeNeed.bind($root.self, node)">(X)</span>
                  </span>
                  <span data-bind="click: $root.self.showNeedPrompt" class="addneeds">+<span>
                </div>
                <form class="form-inline" data-bind="submit: $root.self.addNeed.bind($root.self, node)" action="javascript:null;" style="display: none;">
                  <table>
                    <tr>
                      <td><input type="text" class="input-small needname" placeholder="Node Name"></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td>
                        <select class='needflags' data-bind="attr: {id: 'addneed' + node.guid()}">
                          <option value="fneeds">Failover</option>
                          <option value="direct" selected="selected">Direct</option>
                        </select>
                      </td>
                      <td><label data-bind="attr: {for: 'addneed' + node.guid()}">Need type</label></td>
                    </tr>
                  </table>
                </form>
              </td>
            </tr>
          </script>
          <table id="node_table" data-bind="template: { name: 'dwui_nodes', foreach: nodes, as: 'node' }">
          </table>
          <div>
            <form class="form-inline" data-bind="submit: $root.self.addNode.bind($root.self)" action="javascript:null;">
              <input type="text" class="input-small needname" placeholder="Node Name" />
            </form>
          </div>
        </div>
      </div>
      <div class="input_methods" style="display: none;" id="import_adv">
        <textarea id="import_text" class="json_data" data-bind="text: $root.self.exportform()"></textarea> <br />
        <input type="button" value="Import" data-bind="click: $root.self.fromJSON.bind($root.self)">
      </div>
      <div class="input_methods" style="display: none;" id="export">
        <textarea class="json_data" data-bind="text: $root.self.exportform()"></textarea> <br />
        <div></div>
      </div>
      <div class="input_methods" style="display: none;" id="help">
        <div>
          <p>Blue = Nodes that the selected node depend upon.</p>
          <p>Green = Nodes that depend upon the selected node.</p>
          <p>Pink = Remaining dependency path.</p>
        </div>
      </div>
      <div class="input_methods" style="display: none;" id="about">
        <p>Depweb was imagined when a need to make a complex system easier for high level managers see and understand why seemingly unrelated system failures can severely impact email access on their smartphones or tablets.</p>
        <p>The first attempt was done using Microsoft's Visio, but it was horrible, not interactive, unmanageable, and unreadable. There had to be a better way.</p>
        <p>Years later a graphing library was found, D3js, which had built in force graphing capabilities and an example using the characters from Les Miserables. This caused the sparked that would later become Depweb, an interactive tool to help IT help management understand failures and risks faced.</p>
      </div>
    </div>
    <div class="span8">
      <div id="dw_graph"></div>
    </div>
  </div>
</div> <!-- /container -->
<div id="res" style="display: none;">
  <div class="addNeedPrompt">
  <!--$('button.btn', this).click();-->
    <form class="form-inline" action="javascript:null;">
      <input type="text" class="input-small needname" placeholder="Node Name">
      <button type="button" class="btn" style="display:none;">Add</button>
    </form>
  </div>
</div>
<script type="text/javascript">
  var dwui;
</script>
</body>
</html>
